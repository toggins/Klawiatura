name: Check commit for formatting & clang-tidy errors

on:
  push:
  pull_request:

jobs:
  check:
    name: Lint
    runs-on: ubuntu-24.04
    permissions:
      contents: read
    steps:
      - name: Checkout (code only)
        uses: actions/checkout@v5
        with:
          sparse-checkout: |
            src/
            include/
      - name: Fail on clang-tidy warnings
        run: shopt -s globstar; clang-tidy --warnings-as-errors=true -- **/*.{h,c}
      - name: Fail on bad formatting
        run: shopt -s globstar; clang-format --dry-run -Werror -- **/*.{h,c}
